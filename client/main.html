<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="js/ghostnight-engine.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/createjs-2015.11.26.min.js"></script>
        <style>
            canvas{
                left: 50%;
                top: 50%;
                margin: -360px 0 0 -640px;
                position: absolute;
            }
        </style>
        <title>Ghost Night</title>
    </head>
    <body style="background-color:black" onload="init()">
        <canvas id="canvas" name="canvas" width="1280" height="720">Your browser doesn't support canvas.</canvas>
        <script>
            /*global createjs*/ 
            var canvas, stage;
            var drawingCanvas;
            var oldPt;
            var oldMidPt;
            var title;
            var color;
            var stroke;
            var colors;
            var index;
            
            function init() {
            	canvas = document.getElementById("canvas");
            	index = 0;
            	colors = ["#828b20", "#b0ac31", "#cbc53d", "#fad779", "#f9e4ad", "#faf2db", "#563512", "#9b4a0b", "#d36600", "#fe8a00", "#f9a71f"];
            
            	//check to see if we are running in a browser with touch support
            	stage = new createjs.Stage(canvas);
            	stage.autoClear = false;
            	stage.enableDOMEvents(true);
            
            	createjs.Touch.enable(stage);
            	createjs.Ticker.setFPS(24);
            
            	drawingCanvas = new createjs.Shape();
            
            	stage.addEventListener("stagemousedown", handleMouseDown);
            	stage.addEventListener("stagemouseup", handleMouseUp);
            
            	title = new createjs.Text("Click and Drag to draw", "36px Arial", "#777777");
            	title.x = 300;
            	title.y = 200;
            	stage.addChild(title);
            
            	stage.addChild(drawingCanvas);
            	stage.update();
            }
            
            function handleMouseDown(event) {
            	if (!event.primary) { return; }
            	if (stage.contains(title)) {
            		stage.clear();
            		stage.removeChild(title);
            	}
            	color = colors[(index++) % colors.length];
            	stroke = 3;
            	oldPt = new createjs.Point(stage.mouseX, stage.mouseY);
            	oldMidPt = oldPt.clone();
            	
            	var circle = new createjs.Shape();
            	circle.graphics.clear().beginFill(color).drawCircle(0, 0, 10);
            	circle.x = stage.mouseX;
            	circle.y = stage.mouseY;
            	stage.addChild(circle);
            	stage.update();
            	stage.addEventListener("stagemousemove", handleMouseMove);
            }
            
            function handleMouseMove(event) {
            	if (!event.primary) { return; }
            	if(new Transform(stage.mouseX, stage.mouseY).DistanceTo(new Transform(oldPt.x, oldPt.y)) > 20)
                {
                    drawingCanvas.graphics.clear().setStrokeStyle(stroke, 'round', 'round').beginStroke(color).moveTo(oldPt.x, oldPt.y).lineTo(stage.mouseX, stage.mouseY);
                    drawingCanvas.graphics.setStrokeStyle(stroke, 'round', 'round').beginStroke(color).drawCircle(stage.mouseX, stage.mouseY, 8);
                    oldPt.x = stage.mouseX;
                    oldPt.y = stage.mouseY;
                	stage.update();
                }
            }
            
            function handleMouseUp(event) {
            	if (!event.primary) { return; }
            	stage.removeEventListener("stagemousemove", handleMouseMove);
            }
            
            
            // circle = new createjs.Shape();
            // circle.graphics.beginFill("red").drawCircle(0, 0, 40);
            // circle.x = circle.y = 50;
            // stage.addChild(circle);
            // stage.update();
            
            // Road test
            var j0 = new Joint(0, 0);
            var j1 = new Joint(0, 1);
            var j2 = new Joint(1, 1);
            var j3 = new Joint(2, 2);
            var j4 = new Joint(2, 1);
            
            j2.AttachTo(j0);
            j2.AttachTo(j1);
            j3.AttachTo(j2);
            j4.AttachTo(j2);
            
            var rs = new RoadSign(1.5, 1.5, j2, [j0, j1]);
            
            console.log(j2.dest);
            rs.Turn();
            console.log(j2.dest);
            rs.Turn();
            console.log(j2.dest);
            rs.Turn();
            console.log(j2.dest);
            
            
        </script>
    </body>
</html>